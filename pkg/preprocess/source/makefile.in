######################################################################
## Filename:      makefile.in
## Version:       
## Description:   
## Author:        Yannick Copin <y.copin@ipnl.in2p3.fr>
## Created at:    Tue Mar 25 16:21:56 2003
## $Id$
######################################################################

topdir = @top_srcdir@
top_builddir = $(topdir)
subdir = pkg/preprocess/source
include $(topdir)/add_defs/makedefs
include $(topdir)/add_defs/makedefs.local

# ============================================================

# Local libraries

LOCLIB = $(O)/libpreprocess.a

# Targets

WSRC = bichip_build.cxx\
       preprocess_bias.cxx\

SRC =	 preprocess_bias.cxx\
	 preprocess_flat.cxx\
	 preprocess.cxx\
	 rickify.cxx\
	 split_image.cxx\
	 quick_look.cxx\
	 fft_image.cxx\
	 copy_image.cxx\
	 copy_image_slice.cxx\
	 test_extension.cxx\
	 stack_bias.cxx\
	 stack_bichip.cxx\
	 preprocess_dark.cxx\
         filter_image.cxx\

OPTSRC =   substract_overscan.cxx\
	 substract_dark.cxx\
	 substract_flat.cxx\
	 build_flat.cxx\
	 add_poisson.cxx\
	 bichip_assemble.cxx\
	 bichip_sub_bias.cxx\
	 bichip_overscan.cxx\
	 bichip_variance.cxx\
	 stack_bichip_gain.cxx\
	 wr_desc_cat.cxx\
	 add_image.cxx\
	 image_flip.cxx\
	 bichip_build.cxx\
	 hack_B_headers.cxx\

# non-maintained executables
OLDSRC = \
	 odd_even_correct.cxx\


EXE = $(patsubst %.cxx, $(E)/%, $(SRC))
OPTEXE = $(patsubst %.cxx, $(E)/%, $(OPTSRC))
WEXE = $(patsubst %.cxx, $(E)/%, $(WSRC))
OBJ = $(patsubst %.cxx, $(O)/%.o, $(SRC) $(OPTSRC) )

include make.depend

# ============================================================

#OUT : dirbin dirobj $(WEXE)
OUT : dirbin dirobj $(EXE) $(OPTEXE)


# Objects
$(O)/%.o : %.c $(STAND_INC)
	$(C_COMPILE)

# Objects C++
$(O)/%.o : %.cxx $(STAND_INC)
	$(CXXCOMPILE)

# Executables (beware: the % syntax might not be standard)
$(E)/% : $(O)/%.o $(LOCLIB) $(IOLIB) makefile
	$(CXXLINK)
	$(STRIP) $@

# placate make.depend .cxx dependancies
%.cxx %.h :
	@echo ==============================
	@echo WARNING : missing $@
	@echo ==============================

clear:
	rm -f $(OBJ) $(EXE)

makefile: makefile.in  $(top_builddir)/config.status
#	rm make.depend
	cd $(top_builddir) \
	  && CONFIG_FILES=$(subdir)/$@ CONFIG_HEADERS= $(SHELL) ./config.status

make.depend: makefile $(SRC) $(OPTSRC)
	$(CC) -MM $(CFLAGS) -c $(SRC) $(OPTSRC) | sed 's%\(.*\)\.o[ :]*%$$(O)/\1.o make.depend :%' > make.depend

.PHONY : OUT all
